---
- name: ADD_NTP_Lo0 (enable mode commands)
  hosts: "{{ cisco_router }}"
  connection: network_cli
  gather_facts: no

  tasks:
    - name: ADD_NTP_Lo0
      ios_config:
        lines:
          - ntp server 192.168.200.1
          - int lo 0
          - ip address 1.1.1.1 255.255.255.255

    - name: "SAVE CONFIGURATION"
      register: save_config
      ios_command:
        commands:
          - "write memory"
     
    - name: Send Email with Report
      mail:
        host: smtp.gmail.com
        port: 465
        username: "{{ gmail_account }}"
        password: "{{ gmail_account_password }}"
        to: Anthony Lin <anthony.lin.test@gmail.com>
        subject: "Ansible Report"
        body: "The consolidated report for the Cisco IOS Routers can be found in the attached file"
        attach:
         - reports/Consolidated_Cisco_IOS_Report.html
      delegate_to: localhost
      run_once: yes
